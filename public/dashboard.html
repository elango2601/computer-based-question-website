<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - StudentQA</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <nav>
        <div class="logo">Student<span>QA</span></div>
        <div class="nav-links">
            <span id="user-display">User</span>
            <a href="#" class="active">Dashboard</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </nav>

    <div class="container animate-fade-in">
        <h2 class="mb-4">Available Exams</h2>
        <div id="tests-grid"
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
            <!-- Tests loaded dynamically -->
            <div class="text-center p-8" style="grid-column: 1/-1;">Loading available exams...</div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        checkAuth('student');

        async function loadTests() {
            const { status, data } = await apiCall('/tests');
            const grid = document.getElementById('tests-grid');
            grid.innerHTML = '';

            if (status === 200) {
                if (data.length === 0) {
                    grid.innerHTML = '<div class="text-center text-muted" style="grid-column: 1/-1">No exams scheduled.</div>';
                    return;
                }

                const today = new Date().toISOString().split('T')[0];

                data.forEach(test => {
                    const card = document.createElement('div');
                    card.className = 'card test-card';
                    card.style.display = 'flex';
                    card.style.flexDirection = 'column';

                    let statusBadge = '';
                    let actionButton = '';
                    const scheduledDate = test.scheduled_date; // YYYY-MM-DD

                    // Logic for test availability
                    if (scheduledDate > today) {
                        statusBadge = '<span style="background:var(--warning); color:black; padding:2px 8px; border-radius:4px; font-size:0.8rem">Upcoming</span>';
                        actionButton = `<button class="btn btn-secondary" disabled style="opacity:0.5; width:100%">Available on ${scheduledDate}</button>`;
                    } else if (test.is_completed) {
                        statusBadge = '<span style="background:var(--success); color:white; padding:2px 8px; border-radius:4px; font-size:0.8rem">Completed</span>';
                        actionButton = `<a href="solution.html?id=${test.id}" class="btn btn-secondary" style="width:100%">View Solutions</a>
                                         <div class="text-center mt-2 text-sm">Score: ${test.score}/${test.total_questions}</div>`;
                    } else {
                        statusBadge = '<span style="background:var(--primary); color:white; padding:2px 8px; border-radius:4px; font-size:0.8rem">Active</span>';
                        actionButton = `<a href="quiz.html?id=${test.id}" class="btn btn-primary" style="width:100%">Start Exam</a>`;
                    }

                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <h3 style="margin:0">${test.title}</h3>
                            ${statusBadge}
                        </div>
                        <p class="text-muted mb-4 text-sm" style="flex-grow:1">${test.description}</p>
                        <div class="text-xs text-muted mb-4">
                            üìÖ Date: ${test.scheduled_date} <br>
                            ‚è∞ Duration: ${test.duration_minutes} mins
                        </div>
                        <div class="mt-auto">
                            ${actionButton}
                        </div>
                    `;
                    grid.appendChild(card);
                });
            }
        }

        loadTests();
    </script>
</body>

</html>